---
const GITHUB_REPO = 'classmoji/classmoji';

// Fetch star count at build time
async function getStarCount() {
  try {
    const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}`, {
      headers: {
        Accept: 'application/vnd.github.v3+json',
      },
    });

    if (!response.ok) {
      console.warn('Failed to fetch GitHub stars:', response.status);
      return null;
    }

    const data = await response.json();
    return data.stargazers_count;
  } catch (error) {
    console.warn('Error fetching GitHub stars:', error);
    return null;
  }
}

const starCount = await getStarCount();

// Format number with commas for thousands
function formatStarCount(count: number | null): string {
  if (count === null) return '0';
  return count.toLocaleString();
}

const formattedStars = formatStarCount(starCount);
---

{
  starCount !== null && (
    <a
      href="https://github.com/classmoji/classmoji"
      target="_blank"
      rel="noopener noreferrer"
      class="inline-flex items-center text-sm font-medium border border-gray-300 dark:border-gray-700 rounded-lg overflow-hidden hover:border-gray-400 dark:hover:border-gray-600 transition-colors"
      aria-label={`${starCount} stars on GitHub`}
    >
      <span class="flex items-center gap-2 px-3 py-1.5 bg-gray-100/70 dark:bg-gray-800 text-gray-900 dark:text-gray-300 font-semibold">
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          stroke-width="2.5"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
        </svg>
        <span>Stars</span>
      </span>
      <span class="px-3 py-1.5 border-l border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-semibold">
        {formattedStars}
      </span>
    </a>
  )
}
